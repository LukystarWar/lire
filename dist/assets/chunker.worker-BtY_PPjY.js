function f(n,t){const{wpm:c,minDuration:o,maxDuration:e}=t,u=c/60;let i=n.trim().split(/\s+/).length/u*1e3,s=1;return n.includes("...")||n.includes("…")?s+=.3:n.includes(".")||n.includes("!")||n.includes("?")?s+=.2:(n.includes(",")||n.includes(";")||n.includes(":"))&&(s+=.1),(n.includes("—")||n.includes("–"))&&(s+=.15),(n.includes('"')||n.includes('"')||n.includes('"'))&&(s+=.1),i*=s,Math.max(o,Math.min(e,i))}function a(n,t=120){const c=n.split(new RegExp("(?<=[.!?])\\s+")),o=[];let e="";for(const r of c)e&&(e+" "+r).length>t?(e.trim()&&o.push(e.trim()),e=r):e=e?e+" "+r:r;if(e.trim()&&o.push(e.trim()),o.length===0){const r=n.split(/[,;:]\s+/);let i="";for(const s of r)i&&(i+", "+s).length>t?(i.trim()&&o.push(i.trim()),i=s):i=i?i+", "+s:s;i.trim()&&o.push(i.trim())}const u=[];for(const r of o)if(r.length<=t)u.push(r);else{const i=r.split(" ");let s="";for(const l of i)s&&(s+" "+l).length>t?(s.trim()&&u.push(s.trim()),s=l):s=s?s+" "+l:l;s.trim()&&u.push(s.trim())}return u.filter(r=>r.trim().length>0)}function h(n,t){const c=[];return n.forEach((o,e)=>{a(o.content).forEach((r,i)=>{const s=f(r,t);c.push({id:`${e}-${i}`,text:r,chapterIndex:e,chunkIndex:i,duration:s})})}),c}self.addEventListener("message",n=>{const{type:t,payload:c}=n.data;if(t==="PROCESS_CHAPTERS")try{const e={type:"CHUNKS_PROCESSED",payload:{chunks:h(c.chapters,c.timingConfig)}};self.postMessage(e)}catch(o){self.postMessage({type:"ERROR",payload:{error:o instanceof Error?o.message:"Unknown error"}})}});

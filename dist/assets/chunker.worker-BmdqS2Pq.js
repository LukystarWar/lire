function a(n,t){const{wpm:c,minDuration:o,maxDuration:r}=t,l=c/60;let e=n.trim().split(/\s+/).length/l*1e3,s=1;return n.includes("...")||n.includes("â€¦")?s+=.3:n.includes(".")||n.includes("!")||n.includes("?")?s+=.2:(n.includes(",")||n.includes(";")||n.includes(":"))&&(s+=.1),(n.includes("â€”")||n.includes("â€“"))&&(s+=.15),(n.includes('"')||n.includes('"')||n.includes('"'))&&(s+=.1),e*=s,Math.max(o,Math.min(r,e))}function f(n,t=120){const c=n.split(new RegExp("(?<=[.!?])\\s+")),o=[];let r="";for(const i of c)r&&(r+" "+i).length>t?(r.trim()&&o.push(r.trim()),r=i):r=r?r+" "+i:i;if(r.trim()&&o.push(r.trim()),o.length===0){const i=n.split(/[,;:]\s+/);let e="";for(const s of i)e&&(e+", "+s).length>t?(e.trim()&&o.push(e.trim()),e=s):e=e?e+", "+s:s;e.trim()&&o.push(e.trim())}const l=[];for(const i of o)if(i.length<=t)l.push(i);else{const e=i.split(" ");let s="";for(const u of e)s&&(s+" "+u).length>t?(s.trim()&&l.push(s.trim()),s=u):s=s?s+" "+u:u;s.trim()&&l.push(s.trim())}return l.filter(i=>i.trim().length>0)}function h(n,t){const c=[];return n.forEach((o,r)=>{f(o.content).forEach((i,e)=>{const s=a(i,t);c.push({id:`${r}-${e}`,text:i,chapterIndex:r,chunkIndex:e,duration:s})})}),c}self.addEventListener("message",n=>{console.log("ðŸ”§ Worker received message:",n.data);const{type:t,payload:c}=n.data;if(t==="PROCESS_CHAPTERS")try{console.log("ðŸ”§ Processing",c.chapters.length,"chapters...");const o=h(c.chapters,c.timingConfig);console.log("ðŸ”§ Generated",o.length,"chunks");const r={type:"CHUNKS_PROCESSED",payload:{chunks:o}};console.log("ðŸ”§ Sending response to main thread"),self.postMessage(r)}catch(o){console.error("ðŸ”§ Worker error:",o),self.postMessage({type:"ERROR",payload:{error:o instanceof Error?o.message:"Unknown error"}})}});
